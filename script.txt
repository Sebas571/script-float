local player = game.Players.LocalPlayer
local char = script.Parent
local humanoid = char:WaitForChild("Humanoid")
local flying = false

local UserInputService = game:GetService("UserInputService")

function canPlayerFly()
    local leaderstats = player:FindFirstChild("leaderstats")
    return leaderstats and leaderstats:FindFirstChild("CanFly") and leaderstats.CanFly.Value
end

function setFlying(on)
    flying = on
    humanoid.PlatformStand = flying
end

UserInputService.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.KeyCode == Enum.KeyCode.Q and canPlayerFly() then
        setFlying(not flying)
    end
end)

UserInputService.JumpRequest:Connect(function()
    if flying then
        local root = char:FindFirstChild("HumanoidRootPart")
        if root then
            root.Velocity = Vector3.new(0, 50, 0)
        end
    end
end)