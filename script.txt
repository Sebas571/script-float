local player = game.Players.LocalPlayer
local flying = false

local UserInputService = game:GetService("UserInputService")

function canPlayerFly()
    local leaderstats = player:FindFirstChild("leaderstats")
    return leaderstats and leaderstats:FindFirstChild("CanFly") and leaderstats.CanFly.Value
end

function setFlying(on)
    flying = on
    local char = player.Character
    if char then
        local humanoid = char:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.PlatformStand = flying
        end
    end
end

UserInputService.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.KeyCode == Enum.KeyCode.Q and canPlayerFly() then
        setFlying(not flying)
    end
end)

UserInputService.JumpRequest:Connect(function()
    if flying then
        local char = player.Character
        if char then
            local root = char:FindFirstChild("HumanoidRootPart")
            if root then
                root.Velocity = Vector3.new(0, 50, 0)
            end
        end
    end
end)
